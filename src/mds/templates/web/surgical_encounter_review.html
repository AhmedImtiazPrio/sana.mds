{% extends "web/base.html" %}
{% load i18n %}
{% block extrastyle %}
<link rel="stylesheet" href="{{ STATIC_PREFIX }}css/jquery.mobile.css">
<link rel="stylesheet" href="{{ STATIC_PREFIX }}web/css/formstyle.css">
<style>
     #map-canvas {
        width: 384px;
        height: 312px;
     }
</style>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
        function initialize(latitude,longitude) {
                var mapCanvas = document.getElementById('map-canvas');
                var mapOptions = {
                center: new google.maps.LatLng(latitude, longitude),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)
      }
</script>
{% endblock %}
{% block title  %}Encounter Review{% endblock %}
{% block header %}Encounter Review{% endblock %}
{% block content %}
<form>
<div class="form">
<input type="hidden" name="uuid" value="{{ object.uuid }}"/>
<input type="hidden" name="id" value="{{ object.id }}"/>
<div data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
    <!-- <li class="ui-li-static ui-body-inherit "> -->
<div class="ui-body ui-body-a ui-corner-all">
    <table data-role="table" id="encounter-table" data-mode="reflow">
    <thead> 
    <tr>
        <th>Procedure</th>
        <th>Patient</th>
        <th>Submitted by</th>
        <th>Device</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>{{ object.procedure }}</td>
        <td>{{ object.subject }}</td>
        <td>{{ object.observer }}</td>
        <td>{{ object.device }}</td>
    </tr>
    </tbody>
    </table>
</div>
<div class="instruction">
    Please evaluate photos when reviewing submitted patient visit<br/>
    When evaluating, answer yes if the body part is identifiable, 
    the entire incision is present, the light and focus of the photo is good 
    enough to assess the incision.
</div>
{% for obs in observations %}
    <div class="fieldWrapper">
        <label for="id_{{ obs.uuid }}" ><span class="ui-body-inherit">{{ obs.node }}. {{ obs.concept.description }}</span></label>
        {% if obs.concept.uuid == "022f8c4f-ca4b-4d2f-b8c6-20a77bea9065" %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value">{{ obs.value }}</span>
            <div id="map-canvas">
            </div>
            {% with val=obs.value_as_floats %}
            <script>
                $(function(){
                    google.maps.event.addDomListener(window, 'load', initialize({{ val.0 }},{{ val.1 }}));
                });
            </script>
            {% endwith %}
        {% elif obs.is_complex %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value"><img src="{{ obs.url }}" width="96" onclick="window.open('{{ obs.url }}')"></img></span>
            <div class="fieldWrapper ui-corner-all">
                <label for="id_{{ obs.uuid }}_adequate">Is the photograph quality sufficient to allow assessment of infection?</label>
                <select id="id_{{ obs.uuid }}_adequate" name="{{ obs.uuid }}">
                    <option>{% trans 'Yes' %}</option>
                    <option>{% trans 'No' %}</option>
                </select>
            </div>
            <section id="id_{{ obs.uuid }}_criteria" class="ihidden-initial">
                <div class="fieldwrapper">
                    <ul>
                        <li>
                            <input type="checkbox" name="value">Body part is not identifiable.</input>
                        </li>
                        <li>
                            <input type="checkbox" name="value">Entire incision is not present.</input> 
                        </li>
                            <input type="checkbox" name="value">Light is not adequate to assess the incision.</input>
                        <li>
                            <input type="checkbox" name="value">Focus is not adequate to assess the incision.</input>
                        </li>
                    <ul>
                </div>
            </section>
            <script>
                
            </script>
         {% else %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value">{{ obs.value }}</span>
        {% endif %}
    </div>
    {% endfor %}
<!--
</ul>
-->
</div>
</form>
{% endblock %}
