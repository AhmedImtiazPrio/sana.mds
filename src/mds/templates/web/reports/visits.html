{% extends 'web/base.html' %}
{% load i18n %}
{% block title %}{% trans 'Patient Visits' %}{% endblock %}
{% block extrascript %}{% endblock %}
{% block extrastyle %}
<style>
.ui-datepicker-calendar {
    display: none;
    }
</style>
{% endblock %}
{% block header %}{% trans 'Patient Visits' %}{% endblock %}
{% block content %}
{{ selected }}
<!-- select observer -->
<div>
    <h2>{% trans 'Select worker' %}</h2>
    <table>
    <tr>
        <td>
            <select id="id_worker">
                
                <option value="" selected="selected">------------</option>
            {% for object in observers %}
                {% if object.uuid == selected.uuid %}
                    <option value="{{ object.uuid }}" selected>{{ object }}</option>
                {% else %}
                    <option value="{{ object.uuid }}">{{ object }}</option>
                {% endif %}
            {% endfor %}
            </select>
        </td>
        <td>{% trans 'Month' %} <input id="id_date" type="date" value="{{ year }}-{{ month }}" /></td>
    <tr>
    </table>
    <hr/>
</div>
<script>
$('#id_worker').change(function() {
    var dt = $('#id_date').val().split('-');
    var q = { 
        "selected" : $(this).val() ,
        "month" : dt[1] ,
        "year" : dt[0] 
    };
    var qs = $.param(q);
    window.location = "/mds/web/report/visits/?" + qs;
});
</script>
<script>
    // Displays Date picker pop up
    $(function(){
        $('input[type="date"]').datepicker({
            changeMonth: true,
            changeYear: true,
            showButtonPanel: true, 
            dateFormat: 'yy-mm', 
            yearRange : "c-100:c+05",
            onClose: function(dateText, inst) { 
                var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                $(this).datepicker('setDate', new Date(year, month, 1));
            }
        }).prop('type','text');
        $('input[type="date"]').prop('type','text');
     });
</script>
<!-- load summary of assigned visits -->
<div>
<h3>{% trans 'Summary' %} {% if selected %}{{ selected }}{% else %}{% trans 'All' %}{% endif %}</h3>
<h4>{% trans 'Month' %} {{ month }} {% trans 'Year' %} {{ year }}</h4>
<ul>
<li>{% trans 'Tasks Due' %} {{ tasks }}</li>
<li>{% trans 'Completed' %} {{ completed_tasks }}</li>
<li>{% trans 'Late' %} {{ late_tasks }}</li>
</ul>
</div>
<div>
<h3>{% trans 'Patient Visits' %}</h3>
<div>
{% trans 'Number of visits' %}:{{ encounters|length }} 
</div>
<ul>
{% for encounter in encounters %}
    <li>{{ encounter }}
{% endfor %}
</ul>
</div>

{% endblock content %}
