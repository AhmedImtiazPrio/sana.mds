{% extends "web/base.html" %}
{% load i18n %}
{% block extrastyle %}
<link rel="stylesheet" href="{{ STATIC_PREFIX }}css/jquery.mobile.css">
<link rel="stylesheet" href="{{ STATIC_PREFIX }}web/css/formstyle.css">
<style>
     #map-canvas {
        width: 384px;
        height: 312px;
     }
</style>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
        function initialize(latitude,longitude) {
                var mapCanvas = document.getElementById('map-canvas');
                var mapOptions = {
                center: new google.maps.LatLng(latitude, longitude),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)
      }
</script>
{% endblock %}
{% block title  %}Encounter Review{% endblock %}
{% block header %}Encounter Review{% endblock %}
{% block content %}
<form>
<div class="form">

<div data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
    <!-- <li class="ui-li-static ui-body-inherit "> -->
<div class="ui-body ui-body-a ui-corner-all">
    <form id="id_{{ encounter.uuid }}">
        <input type="hidden" name="uuid" value="{{ object.uuid }}"/>
        <input type="hidden" name="id" value="{{ object.id }}"/>
    <table data-role="table" id="encounter-table" data-mode="reflow">
    <tr>
        <td>Procedure</td>
        <td>{{ object.procedure }}</td>
    </tr>
    <tr>
        <td>Submitted by</td>
        <td>{{ object.observer }}</td>
    </tr>
    </tbody>
    </table>
{% for obs in observations %}
    <div class="fieldWrapper">
        <label for="id_{{ obs.uuid }}" ><span class="ui-body-inherit">{{ obs.node }}. {{ obs.concept.description }}</span></label>
        {% if obs.concept.uuid == "022f8c4f-ca4b-4d2f-b8c6-20a77bea9065" %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value">{{ obs.value }}</span>
            <div id="map-canvas">
            </div>
            {% with val=obs.value_as_floats %}
            <script>
                $(function(){
                    google.maps.event.addDomListener(window, 'load', initialize({{ val.0 }},{{ val.1 }}));
                });
            </script>
            {% endwith %}
        {% elif obs.is_complex %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value"><img src="{{ MEDIA_URL }}{{ obs.value_complex }}" width="96" onclick="window.open('{{ MEDIA_URL }}{{ obs.value_complex }}')"></img></span>
            <div class="fieldWrapper ui-corner-all">
                <label for="id_{{ obs.uuid }}_adequate">Is the photograph quality sufficient to allow assessment of infection?</label>
                <select id="id_{{ obs.uuid }}_adequate" name="{{ obs.uuid }}">
                    <option value="true">{% trans 'Yes' %}</option>
                    <option value="false">{% trans 'No' %}</option>
                </select>
            </div>
            <section id="id_{{ obs.uuid }}_criteria" class="hidden-initial">
                <div class="fieldwrapper">
                    <ul>
                        <li><h4>Select all that apply</h4></li>
                        <li>
                            <input type="checkbox" name="value">Body part is not identifiable.</input>
                        </li>
                        <li>
                            <input type="checkbox" name="value">Entire incision is not present.</input> 
                        </li>
                            <input type="checkbox" name="value">Light is not adequate to assess the incision.</input>
                        <li>
                            <input type="checkbox" name="value">Focus is not adequate to assess the incision.</input>
                        </li>
                    <ul>
                </div>
            </section>
            <script>
                // (un)hide the routine posto op visit questions
                $('#id_{{ obs.uuid }}_criteria').hide();
                $('#id_{{ obs.uuid }}_adequate').change(function(){
                    if($(this).val() == "false"){
                        $('#id_{{ obs.uuid }}_criteria').slideDown("fast");
                    } else {
                        $('#id_{{ obs.uuid }}_criteria').slideUp("fast");
                    }
                });

            </script>
         {% else %}
            <span id="id_{{ obs.uuid }}" class="ui-body-inherit value">{{ obs.value }}</span>
        {% endif %}
    </div>
    {% endfor %}
    <div class="actionbar">
        <p align="center" style="font-size:larger">
            <input type="button" id="id_submit" class="show-page-loading-msg" value="Submit" onClick="submitEncounterWeb()">
        </p>
    </div>
    <div>
        <p align="center" style="font-size:larger">
            <a id="id_call_observer" href="tel://{{ object.device.name }}">Call: {{ object.device.name }}</a>
        </p>
    </div>
</div>
</form>
{% endblock %}
